{% extends 'base.html' %}
{% load static %}
{% block title %}
    素材管理
{% endblock %}
{% block content %}
    <div class="x-nav">
      <span class="layui-breadcrumb">
        <span style="font-size: 22px">素材列表</span>
      </span>
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
           href="javascript:location.replace(location.href);" title="刷新">
            <i class="layui-icon" style="line-height:30px">ဂ</i>
        </a>
    </div>
    <div class="layui-tab layui-tab-card">
        <ul class="layui-tab-title" style="text-align: center">
            <li class="layui-this">图片</li>
            <li>视频</li>
        </ul>
        <div class="layui-tab-content" style="height: 100px;">
            <div class="layui-tab-item layui-show">
                <xblock>
                    <button class="layui-btn" onclick="x_admin_show('添加图片','image/upload_img/')"><i
                            class="layui-icon"></i>添加
                    </button>
                    <span class="x-right" style="line-height:40px">共有数据：{{ images.count }}条</span>
                </xblock>
                <table class="layui-table">
                    <thead>
                    <tr>

                        <th>缩略图</th>
                        <th>标签</th>
                        <th>名称</th>
                        <th>最后修改时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for image in images %}
                        <tr>

                            <td style="display: none;" id="img-id">{{ image.nid }}</td>
                            <td><img src="{{ image.image.url }}" width="100px" height="100px"></td>
                            <td>{{ image.tag.title }}</td>
                            <td>{{ image.title }}</td>
                            <td>{{ image.create_time|date:"Y-m-d H:i:s" }}</td>
                            <td class="td-manage">
                                <a title="删除" onclick="member_del(this,{{ image.nid }})" href="javascript:;">
                                    <i class="layui-icon">&#xe640;</i>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>
            </div>
            <div class="layui-tab-item">视频</div>
        </div>
    </div>

{% endblock %}
{% block extra_js %}
    <script>
        /*用户-删除*/
        function member_del(obj, id) {
            layer.confirm('确认要删除吗？', function (index) {
                //发异步删除数据
                $.ajax({
                    url: "{% url 'delete_img' %}",
                    type: "get",
                    data: {
                        all: false,
                        nid: id
                    },
                    success: function (data) {
                        if (data.status) {
                            $(obj).parents("tr").remove();
                            layer.msg('已删除!', {icon: 1, time: 1000});
                        } else {
                            layer.msg('删除失败啦!', {icon: 1, time: 1000});
                        }
                    }
                });

            });
        }


        function delAll(argument) {

            var data = tableCheck.getData();
            layer.confirm('确认要删除吗？' + data, function (index) {
                //捉到所有被选中的，发异步进行删除
                layer.msg('删除成功', {icon: 1});

                $(".layui-form-checked").not('.header').parents('tr').remove();
            });
        }
    </script>

{% endblock %}
